<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>To-Do List</title>
  <style>
    body {
      background: linear-gradient(to right, #36d1dc, #5b86e5);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 30px;
      margin-top: 40px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .back-btn {
      display: inline-block;
      margin-bottom: 20px;
      padding: 8px 16px;
      background-color: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 30px;
    }

    .calendar-day {
      background: #f9f9f9;
      padding: 10px;
      border-radius: 12px;
      text-align: center;
      font-size: 16px;
      cursor: pointer;
    }

    .calendar-day:hover {
      background: #e0f0ff;
    }

    .selected-date {
      border: 2px solid red;
    }

    .task-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .task-input {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    input[type="text"] {
      padding: 10px;
      width: 300px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 14px;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .columns {
      display: flex;
      gap: 20px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .column {
      flex: 1;
      min-width: 280px;
    }

    .column h3 {
      text-align: center;
      margin-bottom: 10px;
    }

    ul {
      list-style: none;
      padding-left: 0;
    }

    li {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    li.progress {
      background: #fff8cc;
    }

    li span {
      flex-grow: 1;
    }

    li.done span {
      text-decoration: line-through;
      color: gray;
    }

    .dropdown-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 6px 10px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
    }

    .dropdown-menu {
      display: none;
      flex-direction: column;
      position: absolute;
      right: 10px;
      top: 40px;
      background: #f1f1f1;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      z-index: 1000;
    }

    .dropdown-menu button {
      background: none;
      color: black;
      padding: 8px 12px;
      border: none;
      text-align: left;
      width: 100%;
      cursor: pointer;
    }

    .dropdown-menu button:hover {
      background: #ddd;
    }

    .dropdown-menu.show {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
    <h1>üìù To-Do List</h1>
    <div id="calendar"></div>
    <div class="task-section">
      <div class="task-input">
        <input type="text" id="taskInput" placeholder="Enter task..." />
        <button onclick="addTask()">Add</button>
      </div>
      <div class="columns">
        <div class="column">
          <h3>To Do</h3>
          <ul id="todoList"></ul>
        </div>
        <div class="column">
          <h3>In Progress</h3>
          <ul id="progressList"></ul>
        </div>
        <div class="column">
          <h3>Done</h3>
          <ul id="doneList"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    let selectedDate = new Date().toISOString().slice(0, 10);
    const todayDate = new Date().toISOString().slice(0, 10);

    function addTask() {
      const input = document.getElementById("taskInput");
      const text = input.value.trim();
      if (!text) return;
      const all = JSON.parse(localStorage.getItem("tasksByDate") || "{}");
      if (!all[selectedDate]) all[selectedDate] = [];
      all[selectedDate].push({ text, status: "todo" });
      localStorage.setItem("tasksByDate", JSON.stringify(all));
      input.value = "";
      loadTasks();
    }

    function loadTasks() {
      const todoList = document.getElementById("todoList");
      const progressList = document.getElementById("progressList");
      const doneList = document.getElementById("doneList");
      todoList.innerHTML = progressList.innerHTML = doneList.innerHTML = "";
      const all = JSON.parse(localStorage.getItem("tasksByDate") || "{}");

      for (const [date, tasks] of Object.entries(all)) {
        tasks.forEach((task, index) => {
          if (task.status === "done" && date !== selectedDate) return;

          const li = document.createElement("li");
          if (task.status === "progress") li.classList.add("progress");
          if (task.status === "done") li.classList.add("done");

          const span = document.createElement("span");
          span.textContent = task.text;
          li.appendChild(span);

          const dropdown = document.createElement("div");
          dropdown.className = "dropdown";

          const btn = document.createElement("button");
          btn.textContent = "...";
          btn.className = "dropdown-btn";

          const menu = document.createElement("div");
          menu.className = "dropdown-menu";

          const editBtn = document.createElement("button");
          editBtn.textContent = "‚úèÔ∏è Edit";
          editBtn.onclick = () => {
            const newText = prompt("Edit task:", task.text);
            if (newText) {
              task.text = newText;
              all[date][index] = task;
              localStorage.setItem("tasksByDate", JSON.stringify(all));
              loadTasks();
            }
          };

          const delBtn = document.createElement("button");
          delBtn.textContent = "üóëÔ∏è Delete";
          delBtn.onclick = () => {
            all[date].splice(index, 1);
            localStorage.setItem("tasksByDate", JSON.stringify(all));
            loadTasks();
          };

          menu.appendChild(editBtn);
          menu.appendChild(delBtn);
          dropdown.appendChild(btn);
          dropdown.appendChild(menu);
          li.appendChild(dropdown);

          li.onclick = (e) => {
            if (e.target.tagName === "BUTTON") return;
            if (task.status === "todo") task.status = "progress";
            else if (task.status === "progress") {
              task.status = "done";
              if (date !== selectedDate) {
                all[selectedDate] = all[selectedDate] || [];
                all[selectedDate].push(task);
                all[date].splice(index, 1);
              }
            } else task.status = "todo";
            localStorage.setItem("tasksByDate", JSON.stringify(all));
            loadTasks();
          };

          if (task.status === "todo") todoList.appendChild(li);
          else if (task.status === "progress") progressList.appendChild(li);
          else if (task.status === "done") doneList.appendChild(li);

          // ÁÇπÂáªÊòæÁ§∫/ÈöêËóèËèúÂçï
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            document.querySelectorAll(".dropdown-menu").forEach(m => m.classList.remove("show"));
            menu.classList.toggle("show");
          });
        });
      }
    }

    // ÁÇπÂáªÈ°µÈù¢Á©∫ÁôΩÂ§ÑÂÖ≥Èó≠ÊâÄÊúâËèúÂçï
    document.addEventListener("click", () => {
      document.querySelectorAll(".dropdown-menu").forEach(m => m.classList.remove("show"));
    });

    function generateCalendar() {
      const calendar = document.getElementById("calendar");
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let i = 0; i < firstDay; i++) {
        calendar.appendChild(document.createElement("div"));
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const d = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const el = document.createElement("div");
        el.className = "calendar-day";
        el.textContent = day;
        if (d === selectedDate) el.classList.add("selected-date");
        el.onclick = () => {
          selectedDate = d;
          document.querySelectorAll(".calendar-day").forEach(c => c.classList.remove("selected-date"));
          el.classList.add("selected-date");
          loadTasks();
        };
        calendar.appendChild(el);
      }
    }

    window.onload = () => {
      generateCalendar();
      loadTasks();
    };
  </script>
</body>
</html>
